{
    "solution": "1625B - Elementary ParticlesNote the following fact. For each optimal pair of harmonious strings, it's true that the right string ends on the last character.Proof: suppose it's wrong. Then, we can expand the strings to the right by one character, and they will remain harmonious.Now, prove the following statement, that will help us to solve this problem. The statement is as follows: the answer is n−min(v−u) where minimum is over all u and v such that u<v and au=av.Proof: consider two elements u and v such that u<v and au=av. Suppose that they are on the same position in a pair of harmonious substrings. What maximal length these substring may have?From what was proved above, we know that we can expand the strings to the right. Take the first string starting in u and the second string starting with v. Then, we get the strings of length n−v+1 after expanding them.Still, it's not enough. So, we will also expand the strings to the left. So, the total length of the strings will become n−v+u, which is equal to n−(v−u). The smaller v−u, the larger the length.To solve the problem, we need to find a pair of nearest equal elements quickly. We can do the following: store all the positions of each element (i. e. all the positions with ai=1, with ai=2 etc.), and then we iterate over ai, go through the pairs of neighboring positions and calculate the minimum. "
}